C51 COMPILER V9.54   MAIN                                                                  01/13/2016 12:20:39 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg51.h>
   2          #include "../lib/lcd.h"
   3          
   4          //declare variables
   5          sbit COL1 = P1^0;
   6          sbit COL2 = P1^1;
   7          sbit COL3 = P1^2;
   8          sbit COL4 = P1^3;
   9          sbit ROW1 = P1^4;
  10          sbit ROW2 = P1^5;
  11          sbit ROW3 = P1^6;
  12          sbit ROW4 = P1^7;
  13          
  14          //functions
  15          void init();
  16          void keyboard_scan_init();
  17          unsigned char scan(unsigned char row);
  18          void lcd_display(unsigned char pos);
  19          
  20          void main(void) { 
  21   1        init();
  22   1        while(1) {
  23   2          
  24   2        }
  25   1      }
  26          
  27          void init() {
  28   1        IE   = 0x81;
  29   1        IT0  = 1;
  30   1        
  31   1        ROW1 = 0;
  32   1        ROW2 = 0;
  33   1        ROW3 = 0;
  34   1        ROW4 = 0;
  35   1      }
  36          
  37          void external_interrupt_isr(void) interrupt 0 {
  38   1        unsigned char i   = 0;
  39   1        unsigned char pos = 0, tmp=0;
  40   1        
  41   1        keyboard_scan_init();
  42   1        
  43   1        for (i=1; i<=4; ++i) {
  44   2          tmp = scan(i);
  45   2          if (tmp != 0) {
  46   3            break;
  47   3          }
  48   2        }
  49   1        if (tmp != 0) {
  50   2          pos = tmp;
  51   2          lcd_display(pos);
  52   2        }
  53   1        
  54   1        init();
C51 COMPILER V9.54   MAIN                                                                  01/13/2016 12:20:39 PAGE 2   

  55   1      }
  56          
  57          void lcd_display(unsigned char pos) {
  58   1        
  59   1        lcd_cmd(0x01);
  60   1        lcd_cmd(0x0C);
  61   1      
  62   1        lcd_data(pos/10+0x30);
  63   1        lcd_data(pos%10+0x30);
  64   1      }
  65          
  66          void keyboard_scan_init() {
  67   1        IE  = 0x00;
  68   1        P1  = 0xFF;
  69   1      }
  70          unsigned char scan(unsigned char row) {
  71   1        unsigned char col = 0;
  72   1        
  73   1        switch(row) {
  74   2          case 1:
  75   2            ROW1 = 0;
  76   2            break;
  77   2          
  78   2          case 2:
  79   2            ROW2 = 0;
  80   2            break;
  81   2          
  82   2          case 3:
  83   2            ROW3 = 0;
  84   2            break;
  85   2          
  86   2          case 4:
  87   2            ROW4 = 0;
  88   2            break;
  89   2          
  90   2          default:
  91   2            break;
  92   2        }
  93   1        
  94   1        if (COL1 == 0) {
  95   2          col  = 1;
  96   2          COL1 = 1;
  97   2        } else if (COL2 == 0) {
  98   2          col  = 2;
  99   2          COL2 = 1;
 100   2        } else if (COL3 == 0) {
 101   2          col  = 3;
 102   2          COL3 = 1;
 103   2        } else if (COL4 == 0) {
 104   2          col  = 4;
 105   2          COL4 = 1;
 106   2        }
 107   1        
 108   1        (ROW1 == 0) ? (ROW1 = 1) : 1;
*** WARNING C275 IN LINE 108 OF main.c: expression with possibly no effect
 109   1        (ROW2 == 0) ? (ROW2 = 1) : 1;
*** WARNING C275 IN LINE 109 OF main.c: expression with possibly no effect
 110   1        (ROW3 == 0) ? (ROW3 = 1) : 1;
*** WARNING C275 IN LINE 110 OF main.c: expression with possibly no effect
 111   1        (ROW4 == 0) ? (ROW4 = 1) : 1;
*** WARNING C275 IN LINE 111 OF main.c: expression with possibly no effect
 112   1        
C51 COMPILER V9.54   MAIN                                                                  01/13/2016 12:20:39 PAGE 3   

 113   1        if (col != 0) {
 114   2          return ((row-1)*4 + col);
 115   2        }
 116   1        
 117   1        return 0;
 118   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    269    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
